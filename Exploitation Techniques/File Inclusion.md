# File Inclusion

## Overview
- File inclusion vulnerabilities affect apps that load files based on user input
- Common in scripting runtimes (PHP, ASP, JSP, Node.js)
- Main risk: reading sensitive files or executing remote content

## Path traversal (directory traversal)
- Attackers use `../` to move outside the intended directory
- Example vulnerable entry point:
  - `get.php?file=`
- Example payloads:
  - `http://webapp.thm/get.php?file=../../../../etc/passwd`
  - `http://webapp.thm/get.php?file=../../../../windows/win.ini`

## LFI (Local File Inclusion)
- Often caused by `include`, `require`, `include_once`, `require_once`
- Simple example:
```php
<?php
include($_GET["lang"]);
?>
```
- If no validation, attacker can include any readable file

### Black box clues
- Error messages can reveal include paths and file extensions
- Example error:
  - `include(languages/THM.php)`
- This implies the app appends `.php` and uses a `languages/` directory

### Common bypasses
- Null byte injection (legacy): `%00` to terminate the filename
  - No longer works in PHP 5.3.4+ and later
- Filter bypass using repeated patterns:
  - `....//....//....//etc/passwd`
- Force included directory:
  - `lang=languages/../../../../etc/passwd`

## RFI (Remote File Inclusion)
- Includes a remote URL into the app
- Requires `allow_url_fopen` (and often `allow_url_include`) to be enabled
- Higher risk because it can lead to RCE
- Example flow
  - Attacker hosts a malicious file
  - App includes it via `http://attacker.thm/cmd.txt`

## Risks
- Sensitive data disclosure (config, credentials)
- XSS or RCE depending on file type
- Denial of service

## Remediation
- Strict input validation and allowlists
- Avoid dynamic includes based on user input
- Disable risky PHP settings if not needed
  - `allow_url_fopen`, `allow_url_include`
- Do not leak errors to users
- Keep frameworks and dependencies updated
- Use a WAF as a defense-in-depth layer
